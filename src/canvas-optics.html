<!DOCTYPE html> 
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Canvas Optics</title>

		<!-- styles -->
		<link rel="stylesheet" type="text/css" href="styles/styles.css" />
		<link rel="stylesheet" type="text/css" href="styles/ui-styles.css" />
		<link rel="stylesheet" type="text/css" href="styles/library/jquery/circular-slider/circular-slider.css" />
	
		<!-- fonts -->
		<link rel="stylesheet" type="text/css" href="fonts/font-awesome-4.5.0/css/font-awesome.css" />
	</head>
	<body>
		<!-- library scripts -->
		<script type="text/javascript" src="scripts/library/underscore/underscore.js"></script>
		<script type="text/javascript" src="scripts/library/jquery/jquery-1.9.1.js"></script>
		<script type="text/javascript" src="scripts/library/jquery/mousewheel/jquery.mousewheel.js"></script>
		<script type="text/javascript" src="scripts/library/jquery/circular-slider/circular-slider.js"></script>
		<script type="text/javascript" src="scripts/library/require/require-min.js"></script>

		<!-- utility scripts -->
		<script type="text/javascript" src="scripts/utilities/math-utils.js"></script>
		<script type="text/javascript" src="scripts/utilities/string-utils.js"></script>
		<script type="text/javascript" src="scripts/utilities/color-utils.js"></script>
		<script type="text/javascript" src="scripts/utilities/unit-conversions.js"></script>
		<script type="text/javascript" src="scripts/utilities/vector2.js"></script>

		<!-- optics model scripts -->
		<script type="text/javascript" src="scripts/models/optics/physics/light.js"></script>	
		<script type="text/javascript" src="scripts/models/optics/physics/spectral-lines.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/surfaces/surface.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/surfaces/planar.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/surfaces/spherical.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/element.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/lens.js"></script>
		<script type="text/javascript" src="scripts/models/optics/elements/elements.js"></script>
		<script type="text/javascript" src="scripts/models/optics/materials/material.js"></script>
		<script type="text/javascript" src="scripts/models/optics/materials/materials.js"></script>
		<script type="text/javascript" src="scripts/models/optics/materials/nikon-glasses.js"></script>
		<script type="text/javascript" src="scripts/models/optics/ray-tracing/ray2.js"></script>
		<script type="text/javascript" src="scripts/models/optics/ray-tracing/path.js"></script>
		<script type="text/javascript" src="scripts/models/optics/ray-tracing/beam.js"></script>
		<script type="text/javascript" src="scripts/models/optics/lights/light.js"></script>
		<script type="text/javascript" src="scripts/models/optics/lights/distant-light.js"></script>
		<script type="text/javascript" src="scripts/models/optics/lights/point-light.js"></script>
		<script type="text/javascript" src="scripts/models/optics/optics.js"></script>

		<!-- optical systems scripts -->
		<script type="text/javascript" src="scripts/models/optical-systems/achromat.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/biconcave.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/biconvex.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/capsule.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/convex-diamond.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/double-gauss.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/fisheye.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/lens-types.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/nagler.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/negative-meniscus.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/plano-concave.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/plano-convex.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/positive-meniscus.js"></script>
		<script type="text/javascript" src="scripts/models/optical-systems/sphere.js"></script>

		<!-- viewport scripts -->
		<script type="text/javascript" src="scripts/views/mouse/mouse-drag-behavior.js"></script>
		<script type="text/javascript" src="scripts/views/mouse/mouse-wheel-behavior.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/bounds/bounds.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/bounds/bounds2.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/grids/grid.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/grids/multi-grid.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/canvas-viewport.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/behaviors/navigation/mouse-drag-pan-behavior.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/behaviors/navigation/mouse-drag-zoom-behavior.js"></script>
		<script type="text/javascript" src="scripts/views/viewports/behaviors/navigation/mouse-wheel-zoom-behavior.js"></script>

		<!-- optics viewing scripts -->
		<script type="text/javascript" src="scripts/views/optics/elements/surfaces/surface-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/elements/surfaces/planar-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/elements/surfaces/spherical-view.js"></script>	
		<script type="text/javascript" src="scripts/views/optics/elements/element-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/elements/lens-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/elements/elements-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/ray-tracing/path-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/ray-tracing/beam-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/lights/light-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/lights/distant-light-view.js"></script>
		<script type="text/javascript" src="scripts/views/optics/lights/point-light-view.js"></script>

		<!-- scene -->
		<div id="text" style="position:absolute"></div>
		<div id="slider" style="position:absolute"></div>
		<canvas id="canvas" style="width:100%; height:100%">
			<i class="fa fa-spinner fa-spin" style="font-size:50px; margin-top:25%"></i>
		</canvas>

		<div id="user-interface">
			<div id="selector">
				<label>Select Optical System: &nbsp;</label>
				<select>
					<option value="achromat">Achromat</option>
					<option value="biconcave">Biconcave</option>
					<option value="biconvex">Biconvex</option>
					<option value="capsule">Capsule</option>
					<option value="convexDiamond">Convex Diamond</option>
					<option value="doubleGauss" selected>Double Gauss</option>
					<option value="fisheye">Fisheye</option>
					<option value="lensTypes">Lens Types</option>
					<option value="nagler">Nagler</option>
					<option value="negativeMeniscus">Negative Meniscus</option>
					<option value="planoConcave">Plano Concave</option>
					<option value="planoConvex">Plano Convex</option>
					<option value="positiveMeniscus">Positive Meniscus</option>
					<option value="sphere">Sphere</option>
				</select>
			</div>
		</div>
		<script>

			// scene
			//
			var optics = doubleGauss;
			var light = new DistantLight(new Vector2(-1, 0), new Vector2(-optics.elements.getAperture(), 0));
			var beam = optics.trace(light.getRays(optics.elements[0].surface1.getPoints(light.numberOfRays, optics.options)));

			// create views
			//
			var elementsView = new ElementsView(optics.elements);
			var lightView = LightView.create(light);
			var beamView = new BeamView(beam);

			$(document).ready(function() {
				require.config({
					baseUrl: 'scripts',
					paths : {
						text: 'library/require/text'
					}
				});

				require(['text!../fonts/font-awesome-4.5.0/css/font-awesome.css'], function() {

					// remove wait spinner
					//
					$('#spinner').remove();

					// create viewport
					//
					var viewport = new CanvasViewport(document.getElementById("canvas"), function(context) {

						// set drawing context
						//
						context.lineWidth = 2 / pixelsPerMillimeter / this.scale;

						// draw beam
						//
						context.strokeStyle = wavelengthToColor(spectralLines.sodium.D);
						beamView.draw(context);

						// draw light
						//
						lightView.draw(context, {
							scale: this.scale
						});

						// draw optics
						//
						elementsView.shade(context);
					}, {
						scale: 1,
						offset: new Vector2(-optics.elements.getLength() / 2, 0),
						grid: new MultiGrid()
					});

					// create viewport behaviors
					//
					var panBehavior = new MouseDragPanBehavior(viewport, null, {
						button: 1
					});
					var zoomBehavior = new MouseDragZoomBehavior(viewport, null, {
						button: 2
					});
					var zoomBehavior = new MouseWheelZoomBehavior(viewport);

					// create user interface controls
					//
					var slider = $('#slider').CircularSlider({
						radius: 100,
						innerCircleRatio: '0.33',
						handleDist: 100,
						min: -90,
						max: 90,
						value: 0,
						clockwise: true,
						labelSuffix: "",
						labelPrefix: "",
						shape: "Half Circle Left",
						touch: true,
						animate: true,
						animateDuration : 360,
						selectable: false,
						formLabel: undefined,

						// update callback
						//
						slide: function(ui, value) {

							// update light location
							//
							light.location = new Vector2(-optics.elements.getAperture(), 0);
							light.location.rotateBy(value);
							light.direction = light.location.normalized();

							// update beam
							//
							beam = optics.trace(light.getRays(optics.elements[0].surface1.getPoints(
								light.numberOfRays, optics.options)));
							beamView = new BeamView(beam);

							// re-render
							//
							viewport.onChange();
						}
					});

					// create UI behaviors
					//
					$("#selector").change(function(event) {
						optics = window[event.target.value];

						// update
						//
						elementsView = new ElementsView(optics.elements);

						// recenter optics
						//
						viewport.offset = new Vector2(-optics.getLength() / 2, 0);

						// update light location
						//
						light.location = new Vector2(-optics.elements.getAperture(), 0);
						light.location.rotateBy(slider.getValue());

						// update beam
						//
						beam = optics.trace(light.getRays(optics.elements[0].surface1.getPoints(
							light.numberOfRays, optics.options)));
						beamView = new BeamView(beam);

						// re-render
						//
						viewport.onChange();
					});
				});
			});
		</script>
	</body>
</html>